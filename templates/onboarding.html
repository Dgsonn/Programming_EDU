<!-- templates/onboarding.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃ o má»«ng báº¡n</title>
    <!-- CSS giá»¯ nguyÃªn nhÆ° báº¡n gá»­i -->
    <style>
        .onboarding-container { max-width: 600px; margin: 50px auto; text-align: center; font-family: sans-serif; }
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.5s; }
        .options { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .option-card { padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; text-align: left; }
        .option-card:hover { border-color: #007bff; background-color: #f0f8ff; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #007bff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="onboarding-container">
    <div style="background: #eee; height: 5px; width: 100%; margin-bottom: 30px; border-radius: 5px;">
        <div id="progress-bar" style="background: #007bff; height: 100%; width: 0%; transition: width 0.3s;"></div>
    </div>

    <div id="step-1" class="step active">
        <h2>Báº¡n hiá»‡n lÃ  ai?</h2>
        <div class="options">
            <div class="option-card" onclick="nextStep(1, 'role', 'student')">ğŸ“ Há»c sinh / Sinh viÃªn</div>
            <div class="option-card" onclick="nextStep(1, 'role', 'professional')">ğŸ’¼ NgÆ°á»i Ä‘i lÃ m</div>
            <div class="option-card" onclick="nextStep(1, 'role', 'other')">â˜• Há»c vÃ¬ Ä‘am mÃª</div>
        </div>
    </div>

    <div id="step-2" class="step">
        <h2>TrÃ¬nh Ä‘á»™ hiá»‡n táº¡i?</h2>
        <div class="options">
            <div class="option-card" onclick="nextStep(2, 'level', 'beginner')">ğŸŒ± Má»›i báº¯t Ä‘áº§u</div>
            <div class="option-card" onclick="nextStep(2, 'level', 'intermediate')">ğŸŒ¿ ÄÃ£ biáº¿t cÆ¡ báº£n</div>
            <div class="option-card" onclick="nextStep(2, 'level', 'advanced')">ğŸŒ³ ÄÃ£ cÃ³ kinh nghiá»‡m</div>
        </div>
    </div>

    <div id="step-loading" class="step">
        <div class="loader"></div>
        <h3 id="loading-text">Äang phÃ¢n tÃ­ch cÃ¢u tráº£ lá»i...</h3>
    </div>
</div>

<script>
    const userAnswers = {};

    function nextStep(currentStepId, key, value) {
        userAnswers[key] = value;
        document.getElementById(`step-${currentStepId}`).classList.remove('active');
        const nextId = currentStepId + 1;
        const nextElement = document.getElementById(`step-${nextId}`);
        document.getElementById('progress-bar').style.width = (currentStepId * 50) + '%';

        if (nextElement) {
            nextElement.classList.add('active');
        } else {
            finishOnboarding();
        }
    }

    function finishOnboarding() {
        document.getElementById('step-loading').classList.add('active');
        
        setTimeout(() => { document.getElementById('loading-text').innerText = "Äang thiáº¿t káº¿ lá»™ trÃ¬nh..."; }, 1500);
        setTimeout(() => { document.getElementById('loading-text').innerText = "Äang cÃ¡ nhÃ¢n hÃ³a..."; }, 3000);

        setTimeout(() => {
            fetch('/api/save-onboarding', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(userAnswers)
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    // QUAN TRá»ŒNG: Chuyá»ƒn vá» trang chá»§ (/)
                    // VÃ¬ app.py Ä‘Ã£ xá»­ lÃ½: Náº¿u cÃ³ role rá»“i thÃ¬ "/" chÃ­nh lÃ  Dashboard
                    window.location.href = "/"; 
                }
            });
        }, 4000);
    }
</script>
</body>
</html>